{% load widget_tweaks %}
{% load static %}
{% load sale_custom_tags %}

<div class="couponprogram-form">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th>{{ couponprogram_form.name.label }}</th>
                <th>{{ couponprogram_form.start_date.label }}</th>
                <th>{{ couponprogram_form.expired_date.label }}</th>
                <td>Trạng thái</td>
                <td>Mã giảm giá</td>
                <td>Doanh thu</td>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ couponprogram_form.name|add_class:'form-control' }}</td>
                <td>{{ couponprogram_form.start_date|add_class:'form-control' }}</td>
                <td>{{ couponprogram_form.expired_date|add_class:'form-control' }}</td>
                <td>{% if couponprogram_form.instance.is_available %}Đang hoạt động{% else %}Không hoạt động{% endif %}</td>
                <td>
                    {{ inlines.total_form_count }}
                    {% comment %} (<a href="{% url 'coupon_list' couponprogram_form.instance.id %}">Chi tiết</a>) {% endcomment %}
                </td>
                <td>0đ</td>
            </tr>
        </tbody>
    </table>
    {% comment %} <table class="table table-striped">
        <thead>
            <tr>
                <th>{{ couponprogram_form.products.label }}</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ couponprogram_form.products|add_class:'form-control' }}</td>
            </tr>
        </tbody>
    </table> {% endcomment %}

    <div class="d-flex">
        <div>
            <h2>Cài đặt điều kiện</h2>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>{{ couponprogram_form.rule_product.label }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            {{ couponprogram_form.rule_product|add_class:'form-control'|attr:'readonly:true' }}
                            {% with couponprogram_form.rule_product.value|json_loads as rule_product_json %}
                            {% include 'sale/couponprogram/product-rules.html' with data=rule_product_json %}
                            {% endwith %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div>
            <h2>Loại khuyến mãi</h2>
            <div class="tabs d-flex">
                <table class="table table-borderless align-top">
                    <tr>
                        <td>
                            {{ couponprogram_form.reward_type.label }}
                            {{ couponprogram_form.reward_type|add_class:'form-control tab-label' }}
                        </td>
                        <td>
                            <div>
                                <table class="tab-content discount align-top" {% if couponprogram_form.reward_type.value != 'discount' %}style="display:none;"{% endif %}>
                                    <tr>
                                        <td>{{ couponprogram_form.discount.label }}</td>
                                        <td>
                                            <div class="d-flex">
                                                {{ couponprogram_form.discount_type|add_class:'form-control' }}
                                                {{ couponprogram_form.discount|add_class:'form-control' }}
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>{{ couponprogram_form.discount_apply_on_type.label }}</td>
                                        <td>{{ couponprogram_form.discount_apply_on_type|add_class:'form-control' }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ couponprogram_form.discount_max_amount.label }}</td>
                                        <td>{{ couponprogram_form.discount_max_amount|add_class:'form-control' }}</td>
                                    </tr>
                                </table>
                    
                                <table class="tab-content free_product align-top" {% if couponprogram_form.reward_type.value != 'free_product' %}style="display:none;"{% endif %}>
                                    <tr>
                                        <td>{{ couponprogram_form.free_product.label }}</td>
                                        <td>{{ couponprogram_form.free_product|add_class:'form-control' }}</td>
                                    </tr>
                                    <tr>
                                        <td>{{ couponprogram_form.free_product_total.label }}</td>
                                        <td>{{ couponprogram_form.free_product_total|add_class:'form-control' }}</td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
{{ couponprogram_form.rule_product.value|json_script:"product_rules" }}
{{ couponprogram_form.rule_customer.value|json_script:"customer_rules" }}
{{ couponprogram_form.rule_order.value|json_script:"order_rules" }}
<style>
  .multiple-select {
    height: 200px;
  }
  .remove_rule_item {
    right: -12px;
  }
</style>
<script src="{% static 'sale/js/couponprogram-form.js' %}"></script>
